<!DOCTYPE html>
<html class="x-admin-sm">

    <head>
        <meta charset="UTF-8">
        <title>New Intent Discovery System</title>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
        <link rel="stylesheet" href="/static/lib/xadmin/css/font.css">
        <link rel="stylesheet" href="/static/lib/xadmin/css/xadmin.css">
        <script type="text/javascript" src="/static/lib/layui/layui.js" charset="utf-8"></script>
        <script type="text/javascript" src="/static/lib/xadmin/js/xadmin.js"></script>
        <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
        <!--[if lt IE 9]>
            <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
            <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
    </head>
    <body>
        <div class="layui-fluid">
            <div class="layui-row">
                <div class="layui-card">
                    <div class="layui-card-body ">
                        <form class="layui-form" enctype="multipart/form-data">
                            <div class="layui-input-inline">
                                <div class="layui-input-inline" >
                                    <div class="layui-form-item" style="position: relative;left: 57%">
                                        <select id="dataset_name" name="dataset_name" >
                                        <option  selected value="null" >Dataset</option>
                                        {% for lines in dataset_List %}
                                            <option  value="{{lines.dataset_id}}" >{{lines.dataset_name}}</option>
                                        {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-input-inline" >
                                    <div class="layui-form-item" style="position: relative;left: 57%">
                                        <select id="model_detection" name="model_detection" >
                                        <option  selected value="null">Annotation</option>
                                        {% for lines in modelList_detection %}
                                            <option  value="{{lines.model_name}}" >{{lines.model_name}}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="layui-input-inline">
                                <div class="layui-input-inline">
                                    <div class="layui-form-item" style="position:relative">
                                        <button class="layui-btn" id="Annotation" lay-filter="add" lay-submit="" style="position: relative;left: 200%">Annotation</button>
                                        {% comment %} <button class="layui-btn"   onclick="reloadExampleTable()" style="position: relative;left: 200%">Annotation</button> {% endcomment %}
                                        {% comment %} <button class="layui-btn" lay-filter="add" lay-submit="" style="position: relative;left: 200%">Annotation</button> {% endcomment %}
                                    </div>
                                </div>
                                <div class="layui-input-inline">
                                    <div class="layui-form-item" style="position:relative">
                                        <button class="layui-btn layui-btn-warm"   style="position: relative;left: 400%" type ='reset'>Clear</button>
                                    </div>
                                </div>
                            </div>
                        </form>

                    </div>
                    <div class="layui-card-body ">
                        <table class="layui-table layui-form" id="sentenceTable" lay-filter="demoEvent" />
                    </div>
                </div>
            </div>
        </div>
        <script>layui.use(['form', 'layer','jquery','table'],
            function() {
                $ = layui.jquery;
                var form = layui.form,
                layer = layui.layer;
                table = layui.table;

                var tableIns = table.render({
                    elem: '#sentenceTable'
                    ,url: '/annotation/getExampleList' //设置异步接口
                    ,page: { //支持传入 laypage 组件的所有参数（某些参数除外，如：jump/elem） - 详见文档
                        layout: ['prev', 'page', 'next'] //自定义分页布局
                        //,curr: 5 //设定初始在第 5 页
                        ,first: 'first'
                        ,last: 'last'
                        
                    }
                    ,cols: [[ //表头
                            {field: 'sentences', title: 'Sentences' , align: 'center'}
                            ,{field: 'real_label', title: 'Selected Label', width: '12%' , align: 'center',templet: function(d){
                                return "<a style = 'color:#FF5722; font-weight:600;'> "+ d.real_label +"</a>"
                                }
                            }
                            ,{field: 'predict_result', title: 'Predict Result', width:  '15%' , align: 'center'  , event: 'updata00', templet: function(d){
                                return "<a style = 'color:#1E9FFF; font-weight:600;' title='Click here to change Real Label'> "+ d.predict_result +"</a>"
                                }
                            }
                            ,{field: 'candidate_label_1', title: 'First Candidate', width: '15%' , align: 'center' , event: 'updata01', templet: function(d){
                                return "<a style = 'color:#1E9FFF; font-weight:600;' title='Click here to change Real Label'> "+ d.candidate_label_1 +"</a>"
                                }
                            }
                            ,{field: 'candidate_label_2', title: 'Second Candidate', width: '15%'  , align: 'center' ,event: 'updata02', templet: function(d){
                                return "<a style = 'color:#1E9FFF; font-weight:600;' title='Click here to change Real Label'> "+ d.candidate_label_2 +"</a>"
                                }
                            }
                            ,{field: 'candidate_label_3', title: 'Third Candidate', width: '15%'  , align: 'center' ,event: 'updata03', templet: function(d){
                                return "<a style = 'color:#1E9FFF; font-weight:600;' title='Click here to change Real Label'> "+ d.candidate_label_3 +"</a>"
                                }
                            }
                            ]] //设置表头
                    ,id: 'Annotation'
                    ,where: {
                        'dataset_name': $('#dataset_name').val(),
                        'model_detection': $('#model_detection').val()
                    }
                });

                //监听单元格事件
                table.on('tool(demoEvent)', function(obj){
                    var data = obj.data;
                    // console.log(data)
                    if(obj.event === 'updata00'){
                        updateByExampleId(obj, data.example_id, data.predict_result)
                    }else if(obj.event === 'updata01'){
                        updateByExampleId(obj, data.example_id, data.candidate_label_1)
                    }else if(obj.event === 'updata02'){
                        updateByExampleId(obj, data.example_id, data.candidate_label_2)
                    }else if(obj.event === 'updata03'){
                        updateByExampleId(obj, data.example_id, data.candidate_label_3)
                    }
                });

                //监听提交
                form.on('submit(add)',function(data) {
                    // console.log("data");
                    tableIns.reload({
                        where: { //设定异步数据接口的额外参数，任意设
                            'dataset_name': $('#dataset_name').val(),
                            'model_detection': $('#model_detection').val()
                        }
                    ,page: { //支持传入 laypage 组件的所有参数（某些参数除外，如：jump/elem） - 详见文档
                        layout: ['prev', 'page', 'next' , 'count' ] //自定义分页布局
                        ,curr: 1 //设定初始在第 5 页
                        ,first: 'first'
                        ,last: 'last'
                        
                    }
                    })
                    layer.confirm(
                        'You can click " Predict Result "、 " First Predict Result "、 " Second Predict Result " or " Third Predict Result " to change " Real Label ".',
                        {
                            icon:6,
                            btn:['Confirm'],
                            title:'Attention Please'
                        }
                    )
                    {% comment %} layui.layer.open({
                        title: 'Attention Please'
                        ,content: 'You can click " Predict Result "、 " First Predict Result "、 " Second Predict Result " or " Third Predict Result " to change " Real Label ".'
                    }) {% endcomment %}
                    return false;
                });

            });

            function updateByExampleId(obj,id,val){
                data = obj.data
                layer.confirm(
                    'Are you sure to change the Real Label to ' + val,
                    {icon:1,
                    btn:['Confirm',"Cancel"],
                    title:'Change Real Label'
                    },
                    function(index){
                    //发异步删除数据
                    
                        layui.layer.close(index)
                        //这里一般是发送修改的Ajax请求
                        
                        var form_data = new FormData();
                        form_data.append('result_id', data.result_id);
                        form_data.append('val', val);
                        $.ajax({
                            url: "/annotation/updateResultByResultId/",
                            type: 'POST',
                            data: form_data,
                            dataType: "json",
                            contentType: false,
                            processData: false,// 获取POST所需的csrftoken
                            success: function (data) {
                                layer.msg(data.msg);
                                if (data.code == 200){
                                    //同步更新表格和缓存对应的值
                                    obj.update({
                                        real_label: val
                                    })
                                }
                            }

                        })
                        return false;                  
                    }
  
                );
                {% comment %} layui.layer.open({
                    title: 'Change Real Label'
                    ,content: 'Are you sure to change the Real Label to ' + val
                    ,yes:function(index,layero){

                        layui.layer.close(index)
                        //这里一般是发送修改的Ajax请求
                        
                        var form_data = new FormData();
                        form_data.append('result_id', data.result_id);
                        form_data.append('val', val);
                        $.ajax({
                            url: "/annotation/updateResultByResultId/",
                            type: 'POST',
                            data: form_data,
                            dataType: "json",
                            contentType: false,
                            processData: false,// 获取POST所需的csrftoken
                            success: function (data) {
                                alert(data.msg);
                                if (data.code == 200){
                                    //同步更新表格和缓存对应的值
                                    obj.update({
                                        real_label: val
                                    })
                                }
                            }

                        })
                        
                    }
                }) {% endcomment %}
            }
            </script>


        <script>var _hmt = _hmt || []; (function() {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?b393d153aeb26b46e9431fabaf0f6190";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
            })();</script>
    </body>

</html>
