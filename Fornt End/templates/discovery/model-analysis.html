<!DOCTYPE html>
<html class="x-admin-sm">

    <head>
        <meta charset="UTF-8">
        <META HTTP-EQUIV="pragma" CONTENT="no-cache"> 
        <META HTTP-EQUIV="Cache-Control" CONTENT="no-cache, must-revalidate"> 
        <META HTTP-EQUIV="expires" CONTENT="0">
        <title>Open Intent Discovery System</title>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
        <link rel="stylesheet" href="/static/lib/xadmin/css/font.css">
        <link rel="stylesheet" href="/static/lib/xadmin/css/xadmin.css">
        <script type="text/javascript" src="/static/lib/layui/layui.js" charset="utf-8"></script>
        <script type="text/javascript" src="/static/lib/xadmin/js/xadmin.js"></script>
        <script src="/static/lib/xadmin/js/echarts.min.js"></script>
        <script src="/static/lib/xadmin/js/ecStat.js"></script>
    </head>
    <body>
    
        <div class="layui-fluid">
            <div class="layui-row">
                <div class="layui-card">
                    <div class="layui-card-body ">
                        <div style="font-weight:700; font-size:20px;color:#555555">Open Intent Discovery</div>
                        <div style="color:#6F6F6F">--Here,pseudo tags are assigned for the new intents </div>
                            <form class="layui-form" enctype="multipart/form-data">

                                    <div class="layui-form-item layui-form-text">
                                        <div class="layui-input-block">
                                            <textarea id='discovery_text_example' placeholder="Please input test sentences !" class="layui-textarea"></textarea>
                                        </div>
                                    </div>
                                    <div class="layui-input-inline">
                                        <div class="layui-input-inline">
                                            <div class="layui-form-item" style="position: relative;left: 60%">
                                                <select id="model_discovery" name="model_discovery">
                                                    <option  selected >Open Intent Discovery</option>
                                                        {% for lines in modelList_discovery %}
                                                            <option  value="{{lines.model_name}}" >{{lines.model_name}}</option>
                                                        {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                        <div class="layui-input-inline ">
                                            <div class="layui-form-item" style="position: relative;left: 77%">
                                                <select id = 'example_select_discovery' name="example_select_discovery" lay-filter="example_select_discovery" >
                                                    <option value="" selected>Examples</option>
                                                    <option value="1">Example-1</option>
                                                    <option value="2">Example-2</option>
                                                    <option value="3">Example-3</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="layui-card-body ">
                                        <div class="layui-input-inline">
                                            <div class="layui-input-inline">
                                                <div class="layui-form-item" style="position:relative">
                                                    <button class="layui-btn" lay-filter="discovery_test"  lay-submit="" style="position: relative;left: 400%">Test</button>
                                                </div>
                                            </div>

                                            <div class="layui-input-inline">
                                                <div class="layui-form-item" style="position:relative">
                                                    <button class="layui-btn layui-btn-warm"   style="position: relative;left: 600%" type ='reset'>Clear</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                            </form>

                            <div class="layui-input-inline ">
                                <div class="layui-input-inline ">
                                        <div style="font-weight:700; font-size:20px;color:#555555">Distribution Of Intents</div>
                                        <div style="color:#6F6F6F">--Show the distribution of intents</div>
                                        <div class="layui-fluid">
                                                <div class="layui-row">
                                                    <div class="layui-card">
                                                        <div class="layui-card-body ">
                                                            <div id="image1" style="width: 360px;height:400px;"></div>
                                                            {% comment %} <script type="text/javascript">
                                                            var myChart1 = echarts.init(document.getElementById('image1'));
                                                            $.get('/static/json/discovery_ring.json', function (data) {
                                                                    myChart1.clear();//清除缓存
                                                                    myChart1.setOption({
                                                                            tooltip: {
                                                                                trigger: 'item',
                                                                                formatter:function(params){
                                                                                                console.log(params);                                                             
                                                                                                var dotHtml2 = '<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:#ff7800"></span>'
                                                                                                mystr ='<span style="font-size:10px;">'+ params.seriesName+'</br>'+ dotHtml2+ params.name +'</span>'+":"+ '<span style="font-weight:800;font-size:13px;">'+"  " +params.percent+'%'+'</span>';
                                                                                                return mystr;
                                                                                            }
                                                                            },
                                                                            legend: {
                                                                                top: '0%',
                                                                                left: 'left'
                                                                            },
                                                                            grid: {
                                                                            left: '3%',
                                                                            right: '4%',
                                                                            bottom: '0%',
                                                                            top:'50%',
                                                                            containLabel: true
                                                                        },
                                                                            series: [
                                                                    {
                                                                        name: 'Distribution Of Intents',
                                                                        type: 'pie',
                                                                        radius: ['30%', '60%'],
                                                                        avoidLabelOverlap: false,
                                                                        itemStyle: {
                                                                            borderRadius: 10,
                                                                            borderColor: '#fff',
                                                                            borderWidth: 2
                                                                        },
                                                                        label: {
                                                                            show: false,
                                                                            position: 'center'
                                                                        },
                                                                        labelLine: {
                                                                            show: false
                                                                        },
                                                                        data: data,
                                                                    
                                                                    }
                                                                ]
                                                                    })
                                                                }, 'json');
                                                        </script> {% endcomment %}
                                                        </div>
                                                    </div>
                                                </div>
                                        </div>
                                </div>
                                <div class="layui-input-inline ">
                                    {% comment %} 关键词抽取排序 {% endcomment %}
                                    <div style="font-weight:700; font-size:20px;color:#555555">Recommended Labels</div>
                                    <div style="color:#6F6F6F">--Recommend tags for each intent type.</div>
                                    {% comment %} json饼图测试 {% endcomment %}
                                    <div class="layui-fluid">
                                            <div class="layui-row">
                                                <div class="layui-card">
                                                    <div class="layui-card-body ">
                                                    <!-- 为 ECharts 准备一个具备大小（宽高）的 DOM -->
                                                        <div id="image2" style="width: 360px;height:400px;"></div>
                                                        {% comment %} <script type="text/javascript">
                                                        // 基于准备好的dom，初始化echarts实例
                                                        var myChart2 = echarts.init(document.getElementById('image2'));
                                                        $.get('/static/json/discovery_pie.json', function (data) {
                                                                myChart2.clear();//清除缓存
                                                                myChart2.setOption({
                                                                        tooltip: {
                                                                            trigger: 'item',
                                                                            formatter:function(params){
                                                                                            console.log(params);                                                             
                                                                                            var dotHtml1 = '<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:#91cc75"></span>'
                                                                                            var dotHtml2 = '<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:#fac858"></span>'
                                                                                            var dotHtml3 = '<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:#ff7800"></span>'
                                                                                            mystr ='<span style="font-size:10px;">'+ params.seriesName+'</br>'+'</span>'+ 
                                                                                            dotHtml1+'<span style="font-size:10px;">'+params.data.KeyWord1 +'</span>'+ "  " +'<span style="font-weight:800;font-size:13px;">'+params.data.value1+'</span>'+'</br>'+
                                                                                            dotHtml2+'<span style="font-size:10px;">'+ params.data.KeyWord2 +'</span>'+"  " +'<span style="font-weight:800;font-size:13px;">'+params.data.value2+'</span>'+'</br>'+
                                                                                            dotHtml3+ '<span style="font-size:10px;">'+params.data.KeyWord3 +'</span>'+"  " +'<span style="font-weight:800;font-size:13px;">'+params.data.value3+'</br>'+'</span>';
                                                                                            return mystr;
                                                                                        }
                                                                        },
                                                                    legend: {
                                                                        top: 'top'
                                                                    },
                                                                    toolbox: {
                                                                        show: true,
                                                                        feature: {
                                                                            mark: {show: false},
                                                                            dataView: {show: false, readOnly: false},
                                                                            restore: {show: false},
                                                                            saveAsImage: {show: false}
                                                                        }
                                                                    },
                                                                    series: [
                                                                        {
                                                                            name: 'Key Word',
                                                                            type: 'pie',
                                                                            radius: [25, 120],
                                                                            label: {
                                                                                show: false
                                                                            },
                                                                            center: ['50%', '50%'],
                                                                            roseType: 'area',
                                                                            itemStyle: {
                                                                                borderRadius: 8
                                                                            },
                                                                            data: data,
                                                                        }
                                                                    ]
                                                                })
                                                            }, 'json');
                                                        
                                                    </script> {% endcomment %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                    </div>
                </div>
            </div>
        </div>



        <script>layui.use(['form', 'layer','jquery'],
            function() {
                $ = layui.jquery;
                var form = layui.form,
                layer = layui.layer;

                form.on('submit(discovery_test)',
                function(data) {
                    console.log(data);
                    var form_data = new FormData();
                    form_data.append('model_discovery', $('#model_discovery').val());
                    form_data.append('example_select_discovery', $('#example_select_discovery').val());
                    console.log(form_data);
                    $.ajax({
                        url: "/discovery/model_analysis/modelAnalysisTest",
                        type: 'POST',
                        data: form_data,
                        dataType: "json",
                        contentType: false,
                        processData: false,// 获取POST所需的csrftoken
                        success: function (data) {
                            //alert(data.msg);
                            layer.msg(data.msg);
                            if (data.code == 200){
                                // 可以对父窗口进行刷新
                                //xadmin.father_reload();
                            }   
                        }

                    });
                    //image_show
                    model_discovery = $('#model_discovery').val()
                    example_select_discovery = $('#example_select_discovery').val()

                    if(model_discovery == 'New Intent Discovery'){
                        layer.msg('Please select Model');
                    } else if( example_select_discovery == 0){
                        layer.msg('Please select example');
                    }else{// 渲染图表
                        var myChart1 = echarts.init(document.getElementById('image1'));
                        $.get('/static/json/my_json.json', function (data) {
                            data_chart_1 = data["discovery_ring"]["discovery_ring"];
                                myChart1.clear();//清除缓存
                                myChart1.setOption({
                                        tooltip: {
                                            trigger: 'item',
                                            formatter:function(params){
                                                            console.log(params);                                                             
                                                            var dotHtml2 = '<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:#ff7800"></span>'
                                                            mystr ='<span style="font-size:10px;">'+ params.seriesName+'</br>'+ dotHtml2+ params.name +'</span>'+":"+ '<span style="font-weight:800;font-size:13px;">'+"  " +params.percent+'%'+'</span>';
                                                            return mystr;
                                                        }
                                        },
                                        legend: {
                                            top: '0%',
                                            left: 'left'
                                        },
                                        grid: {
                                        left: '3%',
                                        right: '4%',
                                        bottom: '0%',
                                        top:'50%',
                                        containLabel: true
                                    },
                                        series: [
                                {
                                    name: 'Distribution Of Intents',
                                    type: 'pie',
                                    radius: ['30%', '60%'],
                                    avoidLabelOverlap: false,
                                    itemStyle: {
                                        borderRadius: 10,
                                        borderColor: '#fff',
                                        borderWidth: 2
                                    },
                                    label: {
                                        show: false,
                                        position: 'center'
                                    },
                                    labelLine: {
                                        show: false
                                    },
                                    data: data_chart_1,
                                
                                }
                            ]
                                })
                            }, 'json');

                    //image2
                     var myChart2 = echarts.init(document.getElementById('image2'));
                        $.get('/static/json/my_json.json', function (data) {
                            data_chart_2 = data["discovery_pie"]["discovery_pie"];
                                myChart2.clear();//清除缓存
                                myChart2.setOption({
                                        tooltip: {
                                            trigger: 'item',
                                            formatter:function(params){
                                                            console.log(params);                                                             
                                                            var dotHtml1 = '<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:#91cc75"></span>'
                                                            var dotHtml2 = '<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:#fac858"></span>'
                                                            var dotHtml3 = '<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:#ff7800"></span>'
                                                            mystr ='<span style="font-size:10px;">'+ params.seriesName+'</br>'+'</span>'+ 
                                                            dotHtml1+'<span style="font-size:10px;">'+params.data.KeyWord1 +'</span>'+ "  " +'<span style="font-weight:800;font-size:13px;">'+params.data.value1+'</span>'+'</br>'+
                                                            dotHtml2+'<span style="font-size:10px;">'+ params.data.KeyWord2 +'</span>'+"  " +'<span style="font-weight:800;font-size:13px;">'+params.data.value2+'</span>'+'</br>'+
                                                            dotHtml3+ '<span style="font-size:10px;">'+params.data.KeyWord3 +'</span>'+"  " +'<span style="font-weight:800;font-size:13px;">'+params.data.value3+'</br>'+'</span>';
                                                            return mystr;
                                                        }
                                        },
                                    legend: {
                                        top: 'top'
                                    },
                                    toolbox: {
                                        show: true,
                                        feature: {
                                            mark: {show: false},
                                            dataView: {show: false, readOnly: false},
                                            restore: {show: false},
                                            saveAsImage: {show: false}
                                        }
                                    },
                                    series: [
                                        {
                                            name: 'Key Word',
                                            type: 'pie',
                                            radius: [25, 120],
                                            label: {
                                                show: false
                                            },
                                            center: ['50%', '50%'],
                                            roseType: 'area',
                                            itemStyle: {
                                                borderRadius: 8
                                            },
                                            data: data_chart_2,
                                        }
                                    ]
                                })
                            }, 'json');
                    }
                    return false;
                });



                //样例选择监听
                form.on('select(example_select_discovery)', function(data) {
                    discovery_switchBySelect();
                });
            });
        </script>

        <script type="text/javascript">

            function discovery_switchBySelect() {
                // alert('点击select框了')
                var v = $("#example_select_discovery").find("option:selected").text();//得到下拉框的value值
                // alert(v)
                // console.log(v);
                var form_data = new FormData();
                form_data.append('example_num', v);
                $.ajax({
                        url: "/discovery/model_analysis/getModelAnalysisExampleData",
                        type: 'POST',
                        data: form_data,
                        dataType: "json",
                        contentType: false,
                        processData: false,// 获取POST所需的csrftoken
                        success: function (data) {
                            if (data.code == 200){
                                document.getElementById("discovery_text_example").value = data.text
                            }else{
                                alert('Chose Error !')
                            }
                        }
                });
            }
        </script>


        <script>var _hmt = _hmt || []; (function() {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?b393d153aeb26b46e9431fabaf0f6190";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
            })();</script>
    </body>

</html>